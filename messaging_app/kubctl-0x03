#!/bin/bash

echo "Triggering rolling update for Django app..."

# Apply the updated deployment
kubectl apply -f blue_deployment.yaml

# Monitor rollout status
kubectl rollout status deployment/messaging-app-deployment

# Test for downtime (requires port-forward if using minikube)
echo "Testing app availability..."
kubectl port-forward service/messaging-app-service 8000:8000 &

for i in {1..20}; do
  curl -s -o /dev/null -w "%{http_code}\n" http://127.0.0.1:8000/
  sleep 1
done

# Verify current pods
kubectl get pods
